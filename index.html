<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caim√°nCuentacuentos Pro üêä</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --p: #2e7d32; --s: #ffa000; --blue: #1565c0; }
        body { font-family: 'Comic Sans MS', cursive, sans-serif; background: #e8f5e9; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { max-width: 750px; width: 100%; background: white; padding: 30px; border-radius: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; border: 8px solid #c8e6c9; }
        h1 { color: var(--p); font-size: 2.2em; margin-bottom: 5px; }
        .input-group { background: #fff3e0; padding: 20px; border-radius: 20px; margin: 20px 0; border: 2px dashed var(--s); }
        input[type="text"] { width: 85%; padding: 12px; border-radius: 12px; border: 2px solid #ddd; margin: 5px 0; font-size: 1.1em; }
        
        /* LIENZO */
        #canvas-wrap { border: 6px solid var(--p); border-radius: 20px; margin: 20px 0; background: white; overflow: hidden; }
        canvas { display: block; max-width: 100%; height: auto; cursor: crosshair; background: white; }
        
        /* BOTONES */
        .btn-zone { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 15px; }
        button { padding: 12px 25px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; color: white; text-transform: uppercase; transition: 0.2s; }
        
        .btn-main { background: var(--p); box-shadow: 0 4px 0 #1b5e20; width: 100%; }
        .btn-nav { background: #555; box-shadow: 0 4px 0 #333; }
        .btn-share { background: var(--blue); box-shadow: 0 4px 0 #0d47a1; } /* AZUL */
        .btn-pdf { background: var(--s); color: #333; box-shadow: 0 4px 0 #e65100; } /* NARANJA */
        
        button:active { transform: translateY(4px); box-shadow: none; }
        #story-txt { font-size: 1.2em; margin: 15px 0; color: #333; min-height: 50px; }
        hr { border: 0; border-top: 2px solid #eee; margin: 25px 0; width: 100%; }
    </style>
</head>
<body>

<div class="card">
    <h1>üêä Caim√°nCuentacuentos</h1>
    
    <div class="input-group">
        <input type="text" id="author" placeholder="Nombre de la autora">
        <input type="text" id="topic" placeholder="Ej: El caim√°n valiente...">
        <div class="btn-zone">
            <button class="btn-main" onclick="comenzarCuento()">‚ú® CREAR CUENTO AHORA</button>
        </div>
    </div>

    <div id="book-viewer">
        <h2 id="page-label">Bienvenido</h2>
        <div id="story-txt">Escribe arriba para empezar la historia.</div>
        
        <div id="canvas-wrap">
            <canvas id="paintCanvas" width="600" height="400"></canvas>
        </div>

        <div class="btn-zone">
            <button class="btn-nav" onclick="cambiarPagina(-1)">‚¨ÖÔ∏è Anterior</button>
            <input type="color" id="brushColor" value="#2e7d32" style="width:50px; height:45px; border:none; cursor:pointer;">
            <button class="btn-nav" onclick="borrarLienzo()">üßπ Borrar</button>
            <button class="btn-nav" onclick="cambiarPagina(1)">Siguiente ‚û°Ô∏è</button>
        </div>

        <hr>

        <div id="final-zone">
            <h3 id="txt-autor" style="color: var(--p)">Libro de la Autora</h3>
            <div class="btn-zone">
                <button class="btn-share" onclick="copiarEnlace()">üìã COPIAR ENLACE PARA EL NI√ëO</button>
                <button class="btn-pdf" onclick="exportarPDF()">üì• GUARDAR COMO PDF</button>
            </div>
        </div>
    </div>
</div>

<script>
    const canv = document.getElementById('paintCanvas');
    const ctx = canv.getContext('2d');
    let pintando = false;
    let paginaActual = 0;

    // L√≥gica de dibujo simple
    canv.onmousedown = (e) => { pintando = true; dibujar(e); };
    canv.onmouseup = () => { pintando = false; ctx.beginPath(); };
    canv.onmousemove = (e) => { if(pintando) dibujar(e); };

    function dibujar(e) {
        ctx.strokeStyle = document.getElementById('brushColor').value;
        ctx.lineWidth = 5; ctx.lineCap = 'round';
        const rect = canv.getBoundingClientRect();
        ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
        ctx.stroke();
    }

    function comenzarCuento() {
        const nombre = document.getElementById('author').value || "Autora";
        const tema = document.getElementById('topic').value || "Mi Cuento";
        document.getElementById('txt-autor').innerText = "Escrito por: " + nombre;
        document.getElementById('story-txt').innerText = "¬°Hab√≠a una vez un cuento sobre " + tema + "!";
        alert("¬°Cuento listo para colorear!");
    }

    function cambiarPagina(dir) {
        paginaActual += dir;
        document.getElementById('page-label').innerText = "P√ÅGINA " + Math.abs(paginaActual);
        borrarLienzo();
    }

    function borrarLienzo() { ctx.clearRect(0,0,600,400); }

    function copiarEnlace() {
        alert("¬°Enlace listo para enviar!");
    }

    function exportarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('l', 'mm', [210, 148]);
        const autor = document.getElementById('author').value || "Autora";
        doc.text("Caim√°nCuentacuentos - " + autor, 105, 15, {align: 'center'});
        doc.addImage(canv.toDataURL("image/png"), 'PNG', 15, 25, 180, 100);
        doc.save("Mi-Cuento-Final.pdf");
    }
</script>
</body>
</html>
